<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lägg till pass - Miklagaard</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #1a1a2e;
      color: #eee;
      min-height: 100vh;
      padding: 1rem;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
    }

    header h1 {
      font-size: 1.5rem;
      color: #fff;
      margin-bottom: 0.5rem;
    }

    header a {
      color: #e94560;
      text-decoration: none;
    }

    header a:hover {
      text-decoration: underline;
    }

    .card {
      background: #16213e;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .card h2 {
      font-size: 1rem;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      font-size: 0.85rem;
      color: #aaa;
      margin-bottom: 0.5rem;
    }

    input[type="date"],
    input[type="number"],
    input[type="text"] {
      width: 100%;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      background: #0f3460;
      border: 2px solid #0f3460;
      border-radius: 8px;
      color: #fff;
      transition: border-color 0.2s;
    }

    input:focus {
      outline: none;
      border-color: #e94560;
    }

    button {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      font-weight: 600;
      background: #e94560;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #d63850;
    }

    button:active {
      transform: scale(0.98);
    }

    .success-message {
      background: rgba(46, 204, 113, 0.2);
      border: 1px solid #2ecc71;
      color: #2ecc71;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 1rem;
      display: none;
    }

    .success-message.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .recent-entries {
      list-style: none;
    }

    .entry-item {
      background: #0f3460;
      border-radius: 6px;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .entry-date {
      font-size: 0.85rem;
      color: #888;
    }

    .entry-meters {
      font-weight: 600;
      color: #e94560;
    }

    .entry-note {
      font-size: 0.75rem;
      color: #aaa;
      font-style: italic;
    }

    .entry-info {
      flex: 1;
    }

    .entry-delete {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      padding: 0.5rem;
      width: auto;
      font-size: 1.2rem;
    }

    .entry-delete:hover {
      color: #e94560;
    }

    .empty-state {
      text-align: center;
      color: #666;
      padding: 2rem;
    }

    .stats-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .stat-box {
      flex: 1;
      background: #0f3460;
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: #e94560;
    }

    .stat-label {
      font-size: 0.75rem;
      color: #888;
      text-transform: uppercase;
    }

    .export-btn {
      background: #0f3460;
      margin-top: 0.5rem;
    }

    .export-btn:hover {
      background: #1a4a7a;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>⛵ Lägg till roddpass</h1>
      <a href="index.html">← Tillbaka till kartan</a>
    </header>

    <div class="success-message" id="success-message">
      Pass tillagt!
    </div>

    <div class="card">
      <h2>Nytt pass</h2>
      <form id="add-form">
        <div class="form-group">
          <label for="date">Datum</label>
          <input type="date" id="date" required>
        </div>
        <div class="form-group">
          <label for="meters">Meter</label>
          <input type="number" id="meters" placeholder="t.ex. 8000" min="1" required>
        </div>
        <div class="form-group">
          <label for="note">Anteckning (valfritt)</label>
          <input type="text" id="note" placeholder="t.ex. Bra tempo!">
        </div>
        <button type="submit">Lägg till</button>
      </form>
    </div>

    <div class="card">
      <h2>Lokalt sparade pass</h2>
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-value" id="local-count">0</div>
          <div class="stat-label">Pass</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="local-km">0</div>
          <div class="stat-label">km</div>
        </div>
      </div>
      <ul class="recent-entries" id="entries-list">
        <li class="empty-state">Inga lokalt sparade pass</li>
      </ul>
      <button class="export-btn" id="export-btn" style="display:none;">Kopiera till urklipp (CSV)</button>
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'miklagaard_local_rows';

    // Get local entries from localStorage
    function getLocalEntries() {
      const data = localStorage.getItem(STORAGE_KEY);
      return data ? JSON.parse(data) : [];
    }

    // Save entries to localStorage
    function saveLocalEntries(entries) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
    }

    // Format date for display
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('sv-SE', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    // Render entries list
    function renderEntries() {
      const entries = getLocalEntries();
      const list = document.getElementById('entries-list');
      const exportBtn = document.getElementById('export-btn');
      const countEl = document.getElementById('local-count');
      const kmEl = document.getElementById('local-km');

      // Update stats
      countEl.textContent = entries.length;
      const totalKm = entries.reduce((sum, e) => sum + (e.meters || 0), 0) / 1000;
      kmEl.textContent = totalKm.toFixed(1);

      if (entries.length === 0) {
        list.innerHTML = '<li class="empty-state">Inga lokalt sparade pass</li>';
        exportBtn.style.display = 'none';
        return;
      }

      exportBtn.style.display = 'block';

      // Sort by date descending
      const sorted = [...entries].sort((a, b) => new Date(b.date) - new Date(a.date));

      list.innerHTML = sorted.map((entry, index) => {
        const km = (entry.meters / 1000).toFixed(1);
        const originalIndex = entries.findIndex(e => e.date === entry.date && e.meters === entry.meters);
        return `
          <li class="entry-item">
            <div class="entry-info">
              <div class="entry-date">${formatDate(entry.date)}</div>
              ${entry.note ? `<div class="entry-note">${entry.note}</div>` : ''}
            </div>
            <div class="entry-meters">${km} km</div>
            <button class="entry-delete" onclick="deleteEntry(${originalIndex})" title="Ta bort">×</button>
          </li>
        `;
      }).join('');
    }

    // Add new entry
    function addEntry(date, meters, note) {
      const entries = getLocalEntries();
      const entry = { date, meters: parseInt(meters, 10) };
      if (note && note.trim()) {
        entry.note = note.trim();
      }
      entries.push(entry);
      saveLocalEntries(entries);
      renderEntries();
    }

    // Delete entry
    function deleteEntry(index) {
      const entries = getLocalEntries();
      entries.splice(index, 1);
      saveLocalEntries(entries);
      renderEntries();
    }

    // Export to CSV
    function exportToCSV() {
      const entries = getLocalEntries();
      if (entries.length === 0) return;

      const csv = entries.map(e => {
        const note = e.note ? `"${e.note.replace(/"/g, '""')}"` : '';
        return `${e.date},${e.meters},${note}`;
      }).join('\n');

      const header = 'date,meters,note\n';
      navigator.clipboard.writeText(header + csv).then(() => {
        alert('Kopierat till urklipp! Klistra in i Google Sheets.');
      });
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Set default date to today
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('date').value = today;

      // Render existing entries
      renderEntries();

      // Form submission
      document.getElementById('add-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const date = document.getElementById('date').value;
        const meters = document.getElementById('meters').value;
        const note = document.getElementById('note').value;

        addEntry(date, meters, note);

        // Show success message
        const msg = document.getElementById('success-message');
        msg.classList.add('show');
        setTimeout(() => msg.classList.remove('show'), 2000);

        // Reset form (keep date)
        document.getElementById('meters').value = '';
        document.getElementById('note').value = '';
        document.getElementById('meters').focus();
      });

      // Export button
      document.getElementById('export-btn').addEventListener('click', exportToCSV);
    });

    // Make deleteEntry available globally
    window.deleteEntry = deleteEntry;
  </script>
</body>
</html>
